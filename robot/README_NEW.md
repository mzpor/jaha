# 🤖 بات بله - نسخه 2.0.0

## 📋 خلاصه پروژه

بات مدیریت گروه‌های آموزشی با ساختار ماژولار و بهینه شده. این نسخه شامل ریفکتوری کامل و تبدیل فایل‌های JSON از 22 فایل به 4 فایل اصلی است.

## 🏗️ ساختار جدید ماژول‌ها

### **1. ماژول‌های اصلی (Core Modules)**
- `01_core.js` - مدیریت اصلی و تنظیمات
- `02_api.js` - لایه انتزاع API بله
- `03_events.js` - مدیریت رویدادها و ارتباطات

### **2. ماژول‌های کاربری (User Modules)**
- `04_user_manager.js` - مدیریت کاربران
- `05_registration.js` - سیستم ثبت‌نام
- `06_role_manager.js` - مدیریت نقش‌ها

### **3. ماژول‌های گروهی (Group Modules)**
- `07_group_manager.js` - مدیریت گروه‌ها
- `08_attendance.js` - مدیریت حضور
- `09_workshop.js` - مدیریت کارگاه‌ها

### **4. ماژول‌های ارزیابی (Evaluation Modules)**
- `10_evaluation.js` - سیستم ارزیابی
- `11_practice.js` - مدیریت تمرین‌ها
- `12_reports.js` - گزارش‌گیری

### **5. ماژول‌های کمکی (Utility Modules)**
- `13_logs.js` - سیستم لاگ
- `14_time.js` - مدیریت زمان
- `15_utils.js` - توابع کمکی

### **6. ماژول‌های Gateway**
- `16_gateway.js` - Gateway اصلی
- `17_webhook.js` - Webhook handler

## 📁 ساختار فایل‌های JSON جدید

### **قبل از ریفکتوری: 22 فایل**
- `attendance_data.json`
- `coaches.json`
- `evaluation_data.json`
- `evaluation_questions.json`
- `evaluation_results.json`
- `groups_config.json`
- `group_evaluation_config.json`
- `member_roles.json`
- `monthly_reports.json`
- `permanent_members.json`
- `practice_data.json`
- `registrations.json`
- `reports.json`
- `reports_config.json`
- `satisfaction_data.json`
- `settings.json`
- `site-status.json`
- `smart_registration.json`
- `verification_codes.json`
- `website_registrations.json`
- `weekly_reports.json`
- `workshops.json`

### **بعد از ریفکتوری: 4 فایل اصلی**
1. **`core_config.json`** - تنظیمات اصلی سیستم
2. **`user_management.json`** - مدیریت کاربران و ثبت‌نام
3. **`evaluation_system.json`** - سیستم ارزیابی و تمرین
4. **`attendance_reports.json`** - حضور و گزارش‌ها

**نکته:** فایل `workshops.json` حفظ شده و در ساختار جدید استفاده می‌شود.

## 🚀 نحوه استفاده

### **1. نصب وابستگی‌ها**
```bash
npm install
```

### **2. اجرای migration**
```bash
# تبدیل فایل‌های JSON (با پشتیبان‌گیری)
node migrate_json.js

# تبدیل و حذف فایل‌های قدیمی
node migrate_json.js --remove-old
```

### **3. اجرای سیستم**
```bash
# اجرای نسخه جدید
node index_new.js

# اجرای نسخه قدیمی (در صورت نیاز)
node index.js
```

## 🔧 ویژگی‌های جدید

### **✅ بهبودهای انجام شده**
- **ساختار ماژولار:** هر بخش در ماژول جداگانه
- **مدیریت رویدادها:** سیستم event-driven
- **Gateway API:** دسترسی REST API به سیستم
- **سیستم لاگ پیشرفته:** لاگ‌گیری با سطوح مختلف
- **مدیریت زمان:** توابع کمکی برای تاریخ و زمان
- **پشتیبان‌گیری خودکار:** حفظ داده‌ها در migration
- **کد تمیز:** حذف کدهای تکراری و بهینه‌سازی

### **🔄 تغییرات ساختاری**
- **فایل‌های JSON:** از 22 به 4 فایل
- **ماژول‌ها:** شماره‌گذاری منظم و مستقل
- **Polling:** بهینه‌سازی و مدیریت خطا
- **Event System:** ارتباط بین ماژول‌ها
- **Error Handling:** مدیریت خطاهای جامع

## 📊 آمار پروژه

### **قبل از ریفکتوری**
- تعداد فایل‌های JSON: **22**
- ساختار: **غیرمنظم و پراکنده**
- نگهداری: **سخت و پیچیده**
- عملکرد: **متوسط**

### **بعد از ریفکتوری**
- تعداد فایل‌های JSON: **4**
- ساختار: **منظم و ماژولار**
- نگهداری: **آسان و سیستماتیک**
- عملکرد: **بهینه و سریع**

## 🛠️ توسعه و نگهداری

### **اضافه کردن ماژول جدید**
1. فایل ماژول را در دایرکتوری اصلی ایجاد کنید
2. شماره مناسب به نام فایل بدهید
3. در `index_new.js` import کنید
4. در constructor مقداردهی کنید

### **تغییر تنظیمات**
- تنظیمات اصلی: `01_core.js`
- تنظیمات API: `02_api.js`
- تنظیمات سیستم: `core_config.json`

### **اضافه کردن رویداد جدید**
```javascript
// در ماژول مربوطه
this.eventManager.emitEvent('event:name', data);

// در ماژول دیگر
this.eventManager.onEvent('event:name', (data) => {
    // پردازش رویداد
});
```

## 🔍 عیب‌یابی

### **مشکلات رایج**
1. **خطای ماژول:** بررسی import و require
2. **خطای JSON:** بررسی ساختار فایل‌های داده
3. **خطای API:** بررسی توکن و تنظیمات بله
4. **خطای Gateway:** بررسی پورت و تنظیمات

### **لاگ‌ها**
- لاگ‌ها در دایرکتوری `logs/` ذخیره می‌شوند
- سطح لاگ: `info`, `warn`, `error`, `debug`
- لاگ‌های اخیر: `/api/logs/recent`
- جستجو در لاگ‌ها: `/api/logs/search`

## 📈 عملکرد

### **بهبودهای عملکرد**
- **حافظه:** کاهش مصرف حافظه با ساختار بهینه
- **سرعت:** افزایش سرعت پردازش پیام‌ها
- **مقیاس‌پذیری:** امکان اضافه کردن ماژول‌های جدید
- **پایداری:** مدیریت خطاهای بهتر و recovery

### **نظارت**
- **Gateway API:** `/api/system/status`
- **آمار رویدادها:** `/api/events/stats`
- **وضعیت سیستم:** `/health`

## 🔒 امنیت

### **ویژگی‌های امنیتی**
- **احراز هویت:** بررسی نقش کاربران
- **مجوزها:** کنترل دسترسی بر اساس نقش
- **اعتبارسنجی:** بررسی ورودی‌های کاربر
- **لاگ امنیتی:** ثبت فعالیت‌های مهم

## 📝 یادداشت‌های توسعه

### **نکات مهم**
1. **Migration:** همیشه قبل از migration پشتیبان بگیرید
2. **Testing:** ماژول‌های جدید را تست کنید
3. **Documentation:** تغییرات را مستند کنید
4. **Versioning:** نسخه‌گذاری مناسب انجام دهید

### **آینده**
- **Database:** امکان انتقال به پایگاه داده
- **Microservices:** تفکیک بیشتر ماژول‌ها
- **API Gateway:** توسعه بیشتر Gateway
- **Monitoring:** ابزارهای نظارت پیشرفته

## 🤝 مشارکت

### **راهنمای مشارکت**
1. Fork پروژه
2. ایجاد branch جدید
3. اعمال تغییرات
4. تست کردن
5. ارسال Pull Request

### **استانداردهای کد**
- **نام‌گذاری:** camelCase برای متغیرها، PascalCase برای کلاس‌ها
- **توضیحات:** فارسی برای توضیحات، انگلیسی برای نام‌ها
- **ساختار:** ماژولار و قابل نگهداری
- **Error Handling:** مدیریت خطای جامع

## 📞 پشتیبانی

### **راه‌های ارتباطی**
- **Issues:** GitHub Issues
- **Documentation:** README و فایل‌های مستندات
- **Community:** گروه‌های توسعه‌دهندگان

---

**نسخه:** 2.0.0  
**تاریخ:** 1404/05/17  
**وضعیت:** ✅ تکمیل شده  
**مخزن:** robot/
